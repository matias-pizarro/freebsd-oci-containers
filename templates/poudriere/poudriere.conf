server {
    listen       80;
    server_name  localhost;

    #access_log  /var/log/nginx/host.access.log  main;

    root   /usr/local/share/poudriere/html;
    index  index.html;

    # Allow caching static resources
    location ~* ^.+\.(jpg|jpeg|gif|png|ico|svg|woff|css|js|html)$ {
        add_header Cache-Control "public";
        expires 2d;
    }

    location /pkg {
        alias /usr/local/poudriere/data/packages;
        index no-index-file-but-required-directive-to-list-dir-contents;
        autoindex on;
    }

    location /data {
        alias /usr/local/poudriere/data/logs/bulk;

        # Allow caching dynamic files but ensure they get rechecked
        location ~* ^.+\.(log|txz|tbz|bz2|gz)$ {
            add_header Cache-Control "public, must-revalidate, proxy-revalidate";
        }

        # Don't log json requests as they come in frequently and ensure
        # caching works as expected
        location ~* ^.+\.(json)$ {
            add_header Cache-Control "public, must-revalidate, proxy-revalidate";
            access_log off;
            log_not_found off;
        }

        # Allow indexing only in log dirs
        location ~ /data/?.*/(logs|latest-per-pkg)/ {
            autoindex on;
        }

        break;
    }

    #error_page  404              /404.html;
}
